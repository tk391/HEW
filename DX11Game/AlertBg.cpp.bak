//警告時画面赤化
//12/20 佐藤大地
#include "AlertBg.h"
#include "Texture.h"
#include "polygon.h"

//マクロ定義
#define ARTBG_POS_X			0.0f
#define ARTBG_POS_Y			0.0f
#define ARTBG_WIDTH			SCREEN_WIDTH
#define ARTBG_HEIGHT		SCREEN_HEIGHT

const std::string ArtBGTexture= "data/texture/RedBg.png";

//グローバル変数
static ID3D11ShaderResourceView* g_pTexture;
static float g_fAlphaAlt;		//透明度
static bool AltFlg = true;
static bool StartAFlg = false;

//初期化
HRESULT Alert::Init()
{
	HRESULT hr = S_OK;
	ID3D11Device* pDevice = GetDevice();

	//透明度初期化
	g_fAlphaAlt = 0.0f;
	// テクスチャ読込
	hr = CreateTextureFromFile(pDevice, ArtBGTexture.c_str(), &m_pTexture);

	m_vPos = XMFLOAT2(0.0f, 0.0f);
	m_vSize = XMFLOAT2(SCREEN_WIDTH, SCREEN_HEIGHT);

	return hr;
}

//終了
void Alert::Uninit()
{
	// 背景テクスチャ解放
	SAFE_RELEASE(m_pTexture);
}

//アップデート
void UpdateAlertBg()
{
	//特に使用しない
}
	
//描画
void Alert::Draw()
{
	ID3D11DeviceContext* pDC = GetDeviceContext();
	SetPolygonSize(m_vSize);
	SetPolygonPos(m_vPos);
	SetPolygonAlpha(g_fAlphaAlt);
	SetPolygonTexture(m_pTexture);
	SetPolygonUV(0.0f, 0.0f);
	DrawPolygon(pDC);
}

//これを呼び出して画面を赤くする
void AlertWarning(bool Flg)
{
	//画面外の情報をPlayerからいただく
	StartAFlg = Flg;

	//画面外情報が「外(true)」の時に処理を行う
	if (StartAFlg)
	{
		if (g_fAlphaAlt <= 0.9f && AltFlg)
		{
			g_fAlphaAlt += 0.007f;
		}
		else
		{
			AltFlg = false;
		}

		if (g_fAlphaAlt >= 0.5f && !AltFlg)
		{
			g_fAlphaAlt -= 0.007f;
		}
		else
		{
			AltFlg = true;
		}
	}

	//画面外情報が「中(false)」の時に処理を行う
	if (!StartAFlg)
	{
		//画面内に戻った後、画面を赤から無色に戻す処理を行う
		if (g_fAlphaAlt > 0.0f)
		{
			g_fAlphaAlt -= 0.01f;
		}
		else if (g_fAlphaAlt <= 0.0f) {
			//フラグ情報を戻して次に画面外に出た時に
			//だんだん赤くなる処理から始める
			AltFlg = true;
		}
	}
}
//ここまで^∀^