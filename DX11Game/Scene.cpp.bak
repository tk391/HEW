#include "Scene.h"
#include "Fade.h"
#include "Title.h"
#include "Select.h"
#include "Option.h"
#include "Game.h"
#include "Result.h"
#include "SceneBase.h"
#include "bg.h"

// グローバル変数
static EScene g_eScene = SCENE_NONE;

static int g_nProgress;//進行度

//クラス宣言
ISceneBase* SceneBase[MAX_SCENE];
EffectManager Scene_EffectManager;

HRESULT Scene::Init() {
	HRESULT hr = S_OK;

	SceneBase[SCENE_NONE] = nullptr;
	SceneBase[SCENE_TITLE] = new Title;
	SceneBase[SCENE_SELECT] = new Select;
	SceneBase[SCENE_GAME] = new Game;
	SceneBase[SCENE_OPTION] = new Option;
	SceneBase[SCENE_RESULT] = new Result;

	Scene_EffectManager.Init();		//全てのエフェクトの初期化
	InitBG();						//背景初期化
	InitFade();
	g_nProgress = 3;//ステージ１からプレイ可能
	hr = SetScene(SCENE_TITLE);	// 最初はタイトル画面へ
	return hr;
}
void Scene::Uninit() {
	SetScene(SCENE_NONE);	// 現在の画面を終了
	UninitFade();
	UninitBG();		//背景終了
	Scene_EffectManager.Uninit();//全てのエフェクトの削除

	for (int i = 0; i < MAX_SCENE; ++i) {
		delete SceneBase[i];
		SceneBase[i] = nullptr;
	}
}
void Scene::Update() {
	//シーンがなかったら処理をしない
	if (g_eScene == SCENE_NONE) {
		return;
	}

	//シーンごとに更新
	SceneBase[g_eScene]->Update();

	UpdateFade();		// フェードイン/アウト更新
}
void Scene::Draw() {
	//シーンがなかったら処理をしない
	if (g_eScene == SCENE_NONE) {
		return;
	}
	//シーンごとに描画
	SceneBase[g_eScene]->Draw();
	DrawFade();			// フェードイン/アウト描画
}

HRESULT SetScene(EScene eScene) {
	HRESULT hr = S_OK;
	//シーンがなかったら処理をしない
	if (g_eScene != SCENE_NONE) {
		// 現在の画面を終了
		//シーンごと
		SceneBase[g_eScene]->Uninit();
	}
	// 画面を入れ替え
	g_eScene = eScene;

	//シーンがなかったら処理をしない
	if (g_eScene != SCENE_NONE) {
		// 次の画面を初期化
		SceneBase[g_eScene]->Init();
		return hr;
	}
}

//進行度の管理
int GetProgress(void) {
	return g_nProgress;
}
void AddProgress(void) {
	g_nProgress++;
}

//ポインタ取得
EffectManager* GetEffectManager(void) {
	return &Scene_EffectManager;
}